<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computer Graphics #2</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

</head>

<body>
    <div class="row container">
        <div class="input-table col-sm-4">
            <table>
                <tbody>
                    <tr>
                        <td colspan="6">Введите координаты точек:</td>
                    </tr>
                    <tr>
                        <td><span class="col-sm">X<sub>1</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="x1Text" min="0" max="1000" value="457" onchange="x1Slider.value = x1Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="x1Text.value = x1Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="1000" value="457" id="x1Slider" step="1" onchange="x1Text.value = x1Slider.value"></td>
                        <td><span class="col-sm">Y<sub>1</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="y1Text" min="0" max="700" value="424" onchange="y1Slider.value = y1Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="y1Text.value = y1Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="700" value="424" id="y1Slider" step="1" onchange="y1Text.value = y1Slider.value"></td>
                    </tr>
                    <tr>
                        <td><span class="col-sm">X<sub>2</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="x2Text" min="0" max="1000" value="821" onchange="x2Slider.value = x2Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="x2Text.value = x2Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="1000" value="821" id="x2Slider" step="1" onchange="x2Text.value = x2Slider.value"></td>
                        <td><span class="col-sm">Y<sub>2</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="y2Text" min="0" max="700" value="188" onchange="y2Slider.value = y2Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="y2Text.value = y2Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="700" value="188" id="y2Slider" step="1" onchange="y2Text.value = y2Slider.value"></td>
                    </tr>
                    <tr>
                        <td><span class="col-sm">X<sub>3</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="x3Text" min="0" max="1000" value="371" onchange="x3Slider.value = x3Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="x3Text.value = x3Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="1000" value="371" id="x3Slider" step="1" onchange="x3Text.value = x3Slider.value"></td>
                        <td><span class="col-sm">Y<sub>3</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="y3Text" min="0" max="700" value="66" onchange="y3Slider.value = y3Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="y3Text.value = y3Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="700" value="66" id="y3Slider" step="1" onchange="y3Text.value = y3Slider.value"></td>
                    </tr>
                    <tr>
                        <td><span class="col-sm">X<sub>4</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="x4Text" min="0" max="1000" value="553" onchange="x4Slider.value = x4Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="x4Text.value = x4Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="1000" value="553" id="x4Slider" step="1" onchange="x4Text.value = x4Slider.value"></td>
                        <td><span class="col-sm">Y<sub>4</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="y4Text" min="0" max="700" value="248" onchange="y4Slider.value = y4Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="y4Text.value = y4Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="700" value="248" id="y4Slider" step="1" onchange="y4Text.value = y4Slider.value"></td>
                    </tr>
                    <tr>
                        <td><span class="col-sm">X<sub>5</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="x5Text" min="0" max="1000" value="285" onchange="x5Slider.value = x5Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="x5Text.value = x5Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="1000" value="285" id="x5Slider" step="1" onchange="x5Text.value = x5Slider.value"></td>
                        <td><span class="col-sm">Y<sub>5</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="y5Text" min="0" max="700" value="300" onchange="y5Slider.value = y5Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="y5Text.value = y5Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="700" value="300" id="y5Slider" step="1" onchange="y5Text.value = y5Slider.value"></td>
                    </tr>
                    <tr>
                        <td><span class="col-sm">X<sub>6</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="x6Text" min="0" max="1000" value="246" onchange="x6Slider.value = x6Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="x6Text.value = x6Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="1000" value="246" id="x6Slider" step="1" onchange="x6Text.value = x6Slider.value"></td>
                        <td><span class="col-sm">Y<sub>6</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="y6Text" min="0" max="700" value="431" onchange="y6Slider.value = y6Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="y6Text.value = y6Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="700" value="431" id="y6Slider" step="1" onchange="y6Text.value = y6Slider.value"></td>
                    </tr>
                    <tr>
                        <td><span class="col-sm">X<sub>7</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="x7Text" min="0" max="1000" value="342" onchange="x7Slider.value = x7Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="x7Text.value = x7Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="1000" value="342" id="x7Slider" step="1" onchange="x7Text.value = x7Slider.value"></td>
                        <td><span class="col-sm">Y<sub>7</sub></span></td>
                        <td><input type="number" style="width: 100%" class="form-control col-sm" name="" id="y7Text" min="0" max="700" value="384" onchange="y7Slider.value = y7Text.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td><input type="range" style="width: 100%" oninput="y7Text.value = y7Slider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="0" max="700" value="384" id="y7Slider" step="1" onchange="y7Text.value = y7Slider.value"></td>
                    </tr>
                    <tr>
                        <td colspan="2">Степень</td>
                        <td colspan="2"><input type="number" style="width: 100%" class="form-control col-sm" name="" id="degreeText" min="1" max="6" value="3" onchange="degreeSlider.value = degreeText.value; draw(ctx, arrX, arrY, degreeText);"></td>
                        <td colspan="2"><input type="range" style="width: 100%" oninput="degreeText.value = degreeSlider.value; draw(ctx, arrX, arrY, degreeText);" class="form-control-range slider col-sm" type="range" min="1" max="6" value="3" id="degreeSlider" step="1"
                                onchange="degreeText.value = degreeSlider.value"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="drawer col-sm-8">
            <canvas id="canvas"></canvas>
        </div>
    </div>
</body>
<script>
    var canv = document.getElementById("canvas");
    canv.width = 1000;
    canv.height = 700;
    canv.strokeStyle = 'rgba(255,255,255,255)';

    var ctx = canv.getContext('2d');
    ctx.fillStyle = "#000000";
    ctx.fillRect(0, 0, canv.width, canv.height);


    ctx.strokeStyle = 'rgba(255,255,255,255)';

    var arrX = [];
    arrX.push(document.getElementById("x1Text"));
    arrX.push(document.getElementById("x2Text"));
    arrX.push(document.getElementById("x3Text"));
    arrX.push(document.getElementById("x4Text"));
    arrX.push(document.getElementById("x5Text"));
    arrX.push(document.getElementById("x6Text"));
    arrX.push(document.getElementById("x7Text"));
    var arrY = [];
    arrY.push(document.getElementById("y1Text"));
    arrY.push(document.getElementById("y2Text"));
    arrY.push(document.getElementById("y3Text"));
    arrY.push(document.getElementById("y4Text"));
    arrY.push(document.getElementById("y5Text"));
    arrY.push(document.getElementById("y6Text"));
    arrY.push(document.getElementById("y7Text"));

    degreeText = document.getElementById("degreeText");
    draw(ctx, arrX, arrY, degreeText);

    function draw(ctx, arrX, arrY, degreeText) {
        ctx.clearRect(0, 0, canv.width, canv.height);
        ctx.fillRect(0, 0, canv.width, canv.height);

        let k = parseInt(degreeText.value, 10);

        let x = [];
        x[0] = parseInt(arrX[0].value, 10);
        x[1] = parseInt(arrX[1].value, 10);
        x[2] = parseInt(arrX[2].value, 10);
        x[3] = parseInt(arrX[3].value, 10);
        x[4] = parseInt(arrX[4].value, 10);
        x[5] = parseInt(arrX[5].value, 10);
        x[6] = parseInt(arrX[6].value, 10);

        let y = [];
        y[0] = parseInt(arrY[0].value, 10);
        y[1] = parseInt(arrY[1].value, 10);
        y[2] = parseInt(arrY[2].value, 10);
        y[3] = parseInt(arrY[3].value, 10);
        y[4] = parseInt(arrY[4].value, 10);
        y[5] = parseInt(arrY[5].value, 10);
        y[6] = parseInt(arrY[6].value, 10);

        let t = make_knot_vector(k, x.length);
        let xx = [];
        xx = linspace(100, 600, 300);

        let xt_p = 0,
            yt_p = 0;

        for (let i = 0; i < xx.length; i++) {
            let xt = 0,
                yt = 0;
            for (let j = 0; j < x.length; j++) {
                xt += (x[j] * B(xx[i], k, j, t));
                yt += (y[j] * B(xx[i], k, j, t));
                if (i == 0) {
                    ctx.beginPath();
                    ctx.arc(x[j], y[j], 3, 0, 2 * Math.PI, false);
                    ctx.stroke();
                }
            }
            if ((xt + yt) != 0 && i > 0) {
                ctx.beginPath();
                ctx.moveTo(xt_p, yt_p);

                ctx.lineTo(xt, yt);
                ctx.stroke();
                ctx.closePath();
            }
            xt_p = xt;
            yt_p = yt;
        }
    }


    function B(x, k, i, t) {

        let c1 = 0.0;
        let c2 = 0.0;

        if (k == 0) {

            if (t[i] <= x && x < t[i + 1]) {
                return 1.0;
            } else {
                return 0.0;
            }
        }

        if (t[i + k] == t[i]) {
            c1 = 0.0;
        } else {
            c1 = (x - t[i]) / (t[i + k] - t[i]) * B(x, k - 1, i, t);
        }

        if (t[i + k + 1] == t[i + 1]) {
            c2 = 0.0;
        } else {
            c2 = (t[i + k + 1] - x) / (t[i + k + 1] - t[i + 1]) * B(x, k - 1, i + 1, t)
        }

        return c1 + c2;
    }

    function make_knot_vector(k, n) {

        let total_knots = (2 + n + k) * 1;
        let outer_knots = (1 + k) * 1;
        let inner_knots = total_knots - 2 * outer_knots;
        console.log(inner_knots, outer_knots, total_knots);
        let knots = [];

        for (let i = 0; i < outer_knots; i++) {
            knots.push(100);
        }
        for (let i = 2; i <= inner_knots + 1; i++) {
            knots.push(100 * i);
        }
        for (let i = 0; i < outer_knots; i++) {
            knots.push((inner_knots + 1) * 100);
        }
        return knots;
    }

    function linspace(a, b, n) {
        if (typeof n === "undefined") n = Math.max(Math.round(b - a) + 1, 1);
        if (n < 2) {
            return n === 1 ? [a] : [];
        }
        var i, ret = Array(n);
        n--;
        for (i = n; i >= 0; i--) {
            ret[i] = (i * b + (n - i) * a) / n;
        }
        return ret;
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>

</html>